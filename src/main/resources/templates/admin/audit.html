<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/header}">
<head>
    <title>–ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</title>
    <!-- –î–æ–±–∞–≤–ª—è–µ–º favicon —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å 500 –æ—à–∏–±–∫–∏ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª–µ–π –∞—É–¥–∏—Ç–∞
        function showAuditDetails(auditId) {
            console.log('Loading audit details for ID:', auditId);

            // –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modalElement = document.getElementById('auditDetailsModal');

            // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const modal = new bootstrap.Modal(modalElement);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
            modalElement.addEventListener('hidden.bs.modal', function () {
                console.log('Modal closed, cleaning up...');
                // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
                document.getElementById('auditDetailsContent').innerHTML = '';
            });

            modalElement.addEventListener('hide.bs.modal', function () {
                console.log('Modal hiding...');
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modal.show();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('auditDetailsContent').innerHTML =
                '<div class="text-center"><div class="spinner-border" role="status"></div><p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞...</p></div>';

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            fetch('/api/audit/' + auditId)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Audit API response:', data);

                    let content = '';
                    if (data.success && data.data) {
                        const auditLog = data.data;
                        content = `
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <strong>–¢–∞–±–ª–∏—Ü–∞:</strong> ${auditLog.tableName}
                                </div>
                                <div class="col-md-6">
                                    <strong>–î–µ–π—Å—Ç–≤–∏–µ:</strong>
                                    <span class="badge bg-${getActionBadgeClass(auditLog.action)}">
                                        ${getActionText(auditLog.action)}
                                    </span>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <strong>ID –∑–∞–ø–∏—Å–∏:</strong> ${auditLog.recordId}
                                </div>
                                <div class="col-md-6">
                                    <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> ${auditLog.changedBy || '–°–∏—Å—Ç–µ–º–∞'}
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-12">
                                    <strong>–î–∞—Ç–∞:</strong> ${formatDateTime(auditLog.changedAt)}
                                </div>
                            </div>`;

                        if (auditLog.oldData) {
                            content += `
                            <div class="row mb-3">
                                <div class="col-12">
                                    <strong>–°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ:</strong>
                                    <pre class="mt-2 p-2 bg-light border rounded" style="font-size: 0.8rem;">${formatJsonData(auditLog.oldData)}</pre>
                                </div>
                            </div>`;
                        }

                        if (auditLog.newData) {
                            content += `
                            <div class="row">
                                <div class="col-12">
                                    <strong>–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:</strong>
                                    <pre class="mt-2 p-2 bg-light border rounded" style="font-size: 0.8rem;">${formatJsonData(auditLog.newData)}</pre>
                                </div>
                            </div>`;
                        }

                        if (!auditLog.oldData && !auditLog.newData) {
                            content += `
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                            </div>`;
                        }
                    } else {
                        content = '<div class="alert alert-danger">–û—à–∏–±–∫–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</div>';
                    }

                    document.getElementById('auditDetailsContent').innerHTML = content;
                })
                .catch(error => {
                    console.error('Error loading audit details:', error);
                    document.getElementById('auditDetailsContent').innerHTML =
                        '<div class="alert alert-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π –∞—É–¥–∏—Ç–∞: ' + error.message + '</div>';
                });
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∏–ª–µ–π –¥–µ–π—Å—Ç–≤–∏–π
        function getActionBadgeClass(action) {
            const actionClasses = {
                'CREATE': 'success',
                'UPDATE': 'warning',
                'DELETE': 'danger'
            };
            return actionClasses[action] || 'secondary';
        }

        function getActionText(action) {
            const actionTexts = {
                'CREATE': '–°–æ–∑–¥–∞–Ω–∏–µ',
                'UPDATE': '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ',
                'DELETE': '–£–¥–∞–ª–µ–Ω–∏–µ'
            };
            return actionTexts[action] || action;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è JSON –¥–∞–Ω–Ω—ã—Ö
        function formatJsonData(jsonString) {
            if (!jsonString) return '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';

            try {
                // –ü—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON
                const parsed = JSON.parse(jsonString);
                return JSON.stringify(parsed, null, 2);
            } catch (e) {
                // –ï—Å–ª–∏ –Ω–µ JSON, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
                return jsonString;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã
        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            try {
                const date = new Date(dateTimeString);
                return date.toLocaleString('ru-RU');
            } catch (e) {
                return dateTimeString;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Audit page loaded');

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ—Ç–∞–ª–µ–π –∞—É–¥–∏—Ç–∞
            document.addEventListener('click', function(e) {
                if (e.target.closest('.audit-details-btn')) {
                    const button = e.target.closest('.audit-details-btn');
                    const auditId = button.getAttribute('data-audit-id');
                    console.log('Audit details button clicked, ID:', auditId);
                    showAuditDetails(auditId);
                }
            });

            // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            document.body.addEventListener('click', function(e) {
                if (e.target.classList.contains('audit-details-btn') ||
                    e.target.closest('.audit-details-btn')) {
                    const button = e.target.classList.contains('audit-details-btn') ?
                        e.target : e.target.closest('.audit-details-btn');
                    const auditId = button.getAttribute('data-audit-id');
                    console.log('Audit details clicked, ID:', auditId);
                    showAuditDetails(auditId);
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
            const userFilter = document.getElementById('userFilter');
            if (userFilter) {
                userFilter.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        applyFilters();
                    }
                });
            }

            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ URL
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('table')) {
                document.getElementById('tableFilter').value = urlParams.get('table');
            }
            if (urlParams.has('action')) {
                document.getElementById('actionFilter').value = urlParams.get('action');
            }
            if (urlParams.has('username')) {
                document.getElementById('userFilter').value = urlParams.get('username');
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Bootstrap –∑–∞–≥—Ä—É–∂–µ–Ω
            if (typeof bootstrap === 'undefined') {
                console.error('Bootstrap not loaded!');
            } else {
                console.log('Bootstrap loaded successfully');
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function applyFilters() {
            const tableName = document.getElementById('tableFilter').value;
            const action = document.getElementById('actionFilter').value;
            const username = document.getElementById('userFilter').value.trim();

            let url = '/admin/audit?';
            const params = [];

            if (tableName) params.push('table=' + encodeURIComponent(tableName));
            if (action) params.push('action=' + encodeURIComponent(action));
            if (username) params.push('username=' + encodeURIComponent(username));

            window.location.href = url + params.join('&');
        }

        // –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∞—É–¥–∏—Ç–∞
        function exportAudit() {
            console.log('Exporting audit data...');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ —ç–∫—Å–ø–æ—Ä—Ç–∞
            showNotification('–ù–∞—á–∏–Ω–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö...', 'info');

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
            fetch('/api/audit?size=1000')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Export data received:', data);
                    if (data.success && data.data && data.data.content) {
                        downloadAuditCSV(data.data.content);
                        showNotification('–ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                    }
                })
                .catch(error => {
                    console.error('Error exporting audit:', error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –∂—É—Ä–Ω–∞–ª–∞ –∞—É–¥–∏—Ç–∞: ' + error.message, 'error');
                });
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è CSV
        function downloadAuditCSV(auditLogs) {
            if (!auditLogs || auditLogs.length === 0) {
                showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
                return;
            }

            const headers = ['ID', '–î–∞—Ç–∞', '–¢–∞–±–ª–∏—Ü–∞', '–î–µ–π—Å—Ç–≤–∏–µ', 'ID –∑–∞–ø–∏—Å–∏', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', '–°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ', '–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ'];
            const csvContent = [
                headers.join(','),
                ...auditLogs.map(log => [
                    log.id,
                    `"${formatDateTime(log.changedAt)}"`,
                    `"${log.tableName}"`,
                    `"${getActionText(log.action)}"`,
                    log.recordId,
                    `"${log.changedBy || '–°–∏—Å—Ç–µ–º–∞'}"`,
                    `"${(log.oldData || '').replace(/"/g, '""')}"`,
                    `"${(log.newData || '').replace(/"/g, '""')}"`
                ].join(','))
            ].join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', `audit_log_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type) {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const existingAlerts = document.querySelectorAll('.alert.position-fixed');
            existingAlerts.forEach(alert => alert.remove());

            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-' + (type === 'error' ? 'danger' : type) +
                                ' alert-dismissible fade show position-fixed';
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 1060; min-width: 300px;';

            const icon = type === 'success' ? 'check' :
                        type === 'error' ? 'exclamation-circle' : 'info-circle';
            alertDiv.innerHTML = `
                <i class="fas fa-${icon} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(alertDiv);

            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }
        // –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è "–∑–∞–ª–∏–ø—à–µ–≥–æ" backdrop
        function closeAllModals() {
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                const bsModal = bootstrap.Modal.getInstance(modal);
                if (bsModal) {
                    bsModal.hide();
                }
            });

            // –£–¥–∞–ª—è–µ–º backdrop –≤—Ä—É—á–Ω—É—é
            const backdrops = document.querySelectorAll('.modal-backdrop');
            backdrops.forEach(backdrop => {
                backdrop.remove();
            });

            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
        }

        // –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        document.addEventListener('DOMContentLoaded', function() {
            // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('btn-close') ||
                    e.target.classList.contains('btn-secondary') &&
                    e.target.textContent.includes('–ó–∞–∫—Ä—ã—Ç—å')) {
                    console.log('Close button clicked');
                    closeAllModals();
                }
            });
        });
    </script>
</head>
<body>
<div layout:fragment="content">
    <!-- Page Header -->
    <section class="py-4 bg-light">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1 class="h2 mb-0">
                        <i class="fas fa-clipboard-list me-2"></i>–ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞
                    </h1>
                    <p class="text-muted mb-0">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ</p>
                </div>
                <div class="col-md-6 text-end">
                    <div class="btn-group">
                        <button class="btn btn-outline-primary" onclick="location.reload()">
                            <i class="fas fa-sync-alt me-2"></i>–û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                        <button class="btn btn-outline-success" onclick="exportAudit()">
                            <i class="fas fa-download me-2"></i>–≠–∫—Å–ø–æ—Ä—Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters -->
    <section class="py-3 border-bottom">
        <div class="container">
            <div class="row g-3 align-items-center">
                <div class="col-md-3">
                    <label for="tableFilter" class="form-label">–¢–∞–±–ª–∏—Ü–∞</label>
                    <select class="form-select" id="tableFilter">
                        <option value="">–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã</option>
                        <option value="users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
                        <option value="bouquets">–ë—É–∫–µ—Ç—ã</option>
                        <option value="orders">–ó–∞–∫–∞–∑—ã</option>
                        <option value="categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="actionFilter" class="form-label">–î–µ–π—Å—Ç–≤–∏–µ</label>
                    <select class="form-select" id="actionFilter">
                        <option value="">–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è</option>
                        <option value="CREATE">–°–æ–∑–¥–∞–Ω–∏–µ</option>
                        <option value="UPDATE">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</option>
                        <option value="DELETE">–£–¥–∞–ª–µ–Ω–∏–µ</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="userFilter" class="form-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</label>
                    <input type="text" class="form-control" id="userFilter" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                </div>
                <div class="col-md-3">
                    <button class="btn btn-primary mt-4 w-100" onclick="applyFilters()">
                        <i class="fas fa-filter me-2"></i>–ü—Ä–∏–º–µ–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Audit Log Table -->
    <section class="py-5">
        <div class="container">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>–î–∞—Ç–∞</th>
                                <th>–¢–∞–±–ª–∏—Ü–∞</th>
                                <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                                <th>ID –∑–∞–ø–∏—Å–∏</th>
                                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                <th>–î–∞–Ω–Ω—ã–µ</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="log : ${auditLogs.content}">
                                <td><small class="text-muted">#[[${log.id}]]</small></td>
                                <td>
                                    <small th:text="${#temporals.format(log.changedAt, 'dd.MM.yyyy')}">01.01.2024</small>
                                    <br><small class="text-muted" th:text="${#temporals.format(log.changedAt, 'HH:mm:ss')}">12:00:00</small>
                                </td>
                                <td>
                                    <span class="badge bg-secondary" th:text="${log.tableName}">users</span>
                                </td>
                                <td>
                                    <span th:classappend="'badge bg-' + ${@adminController.getActionBadgeClass(log.action)}"
                                          th:text="${@adminController.getActionText(log.action)}">
                                        –°–æ–∑–¥–∞–Ω–∏–µ
                                    </span>
                                </td>
                                <td><small>#[[${log.recordId}]]</small></td>
                                <td>
                                    <small th:text="${log.changedBy ?: '–°–∏—Å—Ç–µ–º–∞'}">admin</small>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-info audit-details-btn"
                                            th:data-audit-id="${log.id}"
                                            title="–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr th:if="${auditLogs.empty}">
                                <td colspan="7" class="text-center text-muted py-4">
                                    <i class="fas fa-inbox fa-2x mb-3"></i>
                                    <p class="mb-0">–ó–∞–ø–∏—Å–∏ –∞—É–¥–∏—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <nav aria-label="Audit log pagination" class="mt-4" th:if="${auditLogs.totalPages > 1}">
                        <ul class="pagination justify-content-center">
                            <li class="page-item" th:classappend="${auditLogs.first} ? 'disabled' : ''">
                                <a class="page-link" th:href="@{/admin/audit(page=0)}">
                                    <i class="fas fa-angle-double-left"></i>
                                </a>
                            </li>
                            <li class="page-item" th:classappend="${auditLogs.first} ? 'disabled' : ''">
                                <a class="page-link" th:href="@{/admin/audit(page=${auditLogs.number - 1})}">
                                    <i class="fas fa-angle-left"></i>
                                </a>
                            </li>

                            <li th:each="page : ${#numbers.sequence(0, auditLogs.totalPages - 1)}"
                                class="page-item"
                                th:classappend="${page == auditLogs.number} ? 'active' : ''">
                                <a class="page-link"
                                   th:href="@{/admin/audit(page=${page})}"
                                   th:text="${page + 1}">1</a>
                            </li>

                            <li class="page-item" th:classappend="${auditLogs.last} ? 'disabled' : ''">
                                <a class="page-link" th:href="@{/admin/audit(page=${auditLogs.number + 1})}">
                                    <i class="fas fa-angle-right"></i>
                                </a>
                            </li>
                            <li class="page-item" th:classappend="${auditLogs.last} ? 'disabled' : ''">
                                <a class="page-link" th:href="@{/admin/audit(page=${auditLogs.totalPages - 1})}">
                                    <i class="fas fa-angle-double-right"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </section>
    <!-- Modal for Audit Details -->
    <div class="modal fade" id="auditDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–î–µ—Ç–∞–ª–∏ –∞—É–¥–∏—Ç–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="auditDetailsContent">
                    <!-- Content will be loaded by JavaScript -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>
</div>




</body>
</html>