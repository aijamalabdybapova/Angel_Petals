<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/header}">
<head>
    <title>Админ панель - Цветочный магазин</title>
</head>
<body>
<div layout:fragment="content">
    <!-- Page Header -->
    <section class="py-4 bg-light">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1 class="h2 mb-0">
                        <i class="fas fa-tachometer-alt me-2"></i>Админ панель
                    </h1>
                    <p class="text-muted mb-0">Обзор статистики и управление системой</p>
                </div>
                <div class="col-md-6 text-end">
                    <div class="btn-group">
                        <a th:href="@{/bouquets/manage}" class="btn btn-outline-primary">
                            <i class="fas fa-bouquet me-2"></i>Управление букетами
                        </a>
                        <a th:href="@{/admin/users}" class="btn btn-primary">
                            <i class="fas fa-users me-2"></i>Пользователи
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Statistics Cards -->
    <section class="py-4">
        <div class="container">
            <div class="row g-4">
                <!-- Total Orders -->
                <div class="col-md-3">
                    <div class="card border-0 bg-primary text-white shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h4 class="mb-0" th:text="${totalOrders}">0</h4>
                                    <p class="mb-0">Всего заказов</p>
                                </div>
                                <div class="icon-circle">
                                    <i class="fas fa-shopping-bag fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pending Orders -->
                <div class="col-md-3">
                    <div class="card border-0 bg-warning text-white shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h4 class="mb-0" th:text="${pendingOrders}">0</h4>
                                    <p class="mb-0">Ожидают обработки</p>
                                </div>
                                <div class="icon-circle">
                                    <i class="fas fa-clock fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Total Users -->
                <div class="col-md-3">
                    <div class="card border-0 bg-success text-white shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h4 class="mb-0" th:text="${totalUsers}">0</h4>
                                    <p class="mb-0">Пользователей</p>
                                </div>
                                <div class="icon-circle">
                                    <i class="fas fa-users fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Total Bouquets -->
                <div class="col-md-3">
                    <div class="card border-0 bg-info text-white shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h4 class="mb-0" th:text="${totalBouquets}">0</h4>
                                    <p class="mb-0">Букетов</p>
                                </div>
                                <div class="icon-circle">
                                    <i class="fas fa-bouquet fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Recent Orders and Quick Actions -->
    <section class="py-4">
        <div class="container">
            <div class="row g-4">
                <!-- Recent Orders -->
                <div class="col-lg-8">
                    <div class="card shadow-sm">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">
                                <i class="fas fa-history me-2"></i>Последние заказы
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                    <tr>
                                        <th>Номер</th>
                                        <th>Клиент</th>
                                        <th>Дата</th>
                                        <th>Сумма</th>
                                        <th>Статус</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="order : ${recentOrders}">
                                        <td>
                                            <a th:href="@{/orders/{id}(id=${order.id})}"
                                               class="text-decoration-none">
                                                <strong th:text="${order.orderNumber}">ORD-123456</strong>
                                            </a>
                                        </td>
                                        <td th:text="${order.recipientName}">Иван Иванов</td>
                                        <td>
                                            <small th:text="${#temporals.format(order.createdAt, 'dd.MM.yyyy')}">
                                                01.01.2024
                                            </small>
                                        </td>
                                        <td th:text="'₽' + ${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 2, 'POINT')}">
                                            ₽2,500.00
                                        </td>
                                        <td>
                                            <span th:classappend="'badge bg-' + ${getStatusBadgeClass(order.status)}"
                                                  th:text="${getStatusText(order.status)}">
                                                Обрабатывается
                                            </span>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="text-center mt-3">
                                <a th:href="@{/orders}" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-list me-2"></i>Все заказы
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="col-lg-4">
                    <div class="card shadow-sm">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">
                                <i class="fas fa-bolt me-2"></i>Быстрые действия
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-2">
                                <a th:href="@{/bouquets/create}" class="btn btn-outline-primary text-start">
                                    <i class="fas fa-plus me-2"></i>Добавить букет
                                </a>
                                <a th:href="@{/admin/users}" class="btn btn-outline-success text-start">
                                    <i class="fas fa-users me-2"></i>Управление пользователями
                                </a>
                                <a th:href="@{/orders}" class="btn btn-outline-info text-start">
                                    <i class="fas fa-shopping-bag me-2"></i>Просмотр заказов
                                </a>
                                <a th:href="@{/bouquets/manage}" class="btn btn-outline-warning text-start">
                                    <i class="fas fa-cog me-2"></i>Управление букетами
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- System Info -->
                    <div class="card shadow-sm mt-4">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">
                                <i class="fas fa-info-circle me-2"></i>Информация о системе
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-2">
                                <small class="text-muted">Версия приложения:</small>
                                <div class="fw-bold">1.0.0</div>
                            </div>
                            <div class="mb-2">
                                <small class="text-muted">База данных:</small>
                                <div class="fw-bold">PostgreSQL</div>
                            </div>
                            <div class="mb-2">
                                <small class="text-muted">Время работы:</small>
                                <div class="fw-bold" id="uptime">Загрузка...</div>
                            </div>
                            <div>
                                <small class="text-muted">Последнее обновление:</small>
                                <div class="fw-bold" th:text="${#temporals.format(#temporals.createNow(), 'dd.MM.yyyy HH:mm')}">
                                    01.01.2024 12:00
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    function getStatusBadgeClass(status) {
        switch (status) {
            case 'PENDING': return 'warning';
            case 'CONFIRMED': return 'info';
            case 'IN_PROGRESS': return 'primary';
            case 'COMPLETED': return 'success';
            case 'CANCELLED': return 'danger';
            default: return 'secondary';
        }
    }

    function getStatusText(status) {
        switch (status) {
            case 'PENDING': return 'Ожидает';
            case 'CONFIRMED': return 'Подтвержден';
            case 'IN_PROGRESS': return 'В процессе';
            case 'COMPLETED': return 'Завершен';
            case 'CANCELLED': return 'Отменен';
            default: return status;
        }
    }

    // Simple uptime counter
    document.addEventListener('DOMContentLoaded', function() {
        const startTime = Date.now();
        const uptimeElement = document.getElementById('uptime');

        function updateUptime() {
            const currentTime = Date.now();
            const uptime = currentTime - startTime;
            const hours = Math.floor(uptime / (1000 * 60 * 60));
            const minutes = Math.floor((uptime % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((uptime % (1000 * 60)) / 1000);

            uptimeElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        updateUptime();
        setInterval(updateUptime, 1000);
    });
    /*]]>*/
</script>

<style>
    .icon-circle {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .card {
        transition: transform 0.2s ease;
    }

    .card:hover {
        transform: translateY(-2px);
    }
</style>
</body>
</html>